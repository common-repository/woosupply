jQuery(function($){$("#order_remote_invoice_paid").change(function(){if(this.checked)$("#order_remote_invoice_paid_date").show();else $("#order_remote_invoice_paid_date").hide()});$("#order_remote_invoice_paid_date").toggle($("#order_remote_invoice_paid").prop("checked"));$(lwsBase64.decode($("#lws_woosupply_supplierorder_items").data("template"))).appendTo($("#lws_woosupply_supplierorder_items_body")).find(".lac_select").lac_select();$("#lws_woosupply_supplierorder_items_body").on("keyup",".order_items_row:last-child input",function(){if($(this).val().length>0){$(lwsBase64.decode($("#lws_woosupply_supplierorder_items").data("template"))).appendTo($("#lws_woosupply_supplierorder_items_body")).find(".lac_select").lac_select()}});function lws_woosupply_supplierorder_items_change(e){var me=e!=undefined?$(e.currentTarget):$("#lws_woosupply_supplierorder_items_body");var data={timestamp:document.lws_woosupply_supplierorder_ajax_timestamp=document.lws_woosupply_supplierorder_ajax_timestamp==undefined?0:document.lws_woosupply_supplierorder_ajax_timestamp+1,quantities:[],uprices:[],keys:[]};$("#lws_woosupply_supplierorder_items_body").find(".order_items_row").each(function(){data.quantities.push($(this).find("input.quantity").val());data.uprices.push($(this).find("input.unitPrice").val());data.keys.push($(this).find("input.lws_woosupply_supplierorder_items_key").val())});if(me.prop("tagName").toLowerCase()=="input"){var row=me.closest(".order_items_row");var price=parseFloat(row.find("input.unitPrice").val().replace(",","."));if(!isNaN(price)&&price<0)row.find("input.unitPrice").val("+");row.find("input.amount").val(parseFloat(row.find("input.quantity").val().replace(",","."))*price)}var total=0;$("#lws_woosupply_supplierorder_items_body").find("input.amount").each(function(){var amount=$(this).val();amount=amount.replace(lws_woosupply_price_format.thousand_separator,"");amount=amount.replace(lws_woosupply_price_format.decimal_separator,".");var f=parseFloat(amount);if(!isNaN(f))total+=f});$('#lws_woosupply_supplierorder_items_foot [data-column="total_value"]').html(total);$.ajax({dataType:"json",url:$("#lws_woosupply_supplier_details").data("service"),method:"POST",data:data,success:function(response){if(response.error!=undefined){alert(response.error)}else if(response.timestamp!=undefined&&response.timestamp==document.lws_woosupply_supplierorder_ajax_timestamp){var index=0;$("#lws_woosupply_supplierorder_items_body").find(".order_items_row").each(function(){if(response.quantities[index]!=undefined)$(this).find("input.quantity").val(response.quantities[index]);if(response.uprices[index]!=undefined)$(this).find("input.unitPrice").val(response.uprices[index]);if(response.amounts[index]!=undefined)$(this).find("input.amount").val(response.amounts[index]);++index});if(response.total!=undefined)$('#lws_woosupply_supplierorder_items_foot [data-column="total_value"]').html(response.total)}}}).fail(function(){console.log("Cannot reach price formating webservice.")})}$("#lws_woosupply_supplierorder_items").on("change",".order_items_row input.quantity,.order_items_row input.unitPrice",lws_woosupply_supplierorder_items_change);$("#lws_woosupply_supplierorder_items_body").on("click",".lws-woosupply-supplierorder-item-delete",function(){$(this).closest(".order_items_row").remove();lws_woosupply_supplierorder_items_change()});$("#supplier_edit").click(function(){$(this).hide();$("#supplier-info-div").hide();$("#lws_woosupply_supplier_details").css("display","grid")});$("#delivery_edit").click(function(){$(this).hide();$("#delivery-info-div").hide();$("#lws_woosupply_delivery_details").css("display","grid")});$(".lws-adminpanel-singular-commit-button").click(function(){$("#lws_adminpanel_singular_form_lws_woosupply_supplierorder").find(".lws-required").each(function(){if(!$(this).lws_required("test")){if($(this).closest("#lws_woosupply_supplier_details").length>0)$("#supplier_edit").trigger("click");else if($(this).closest("#lws_woosupply_delivery_details").length>0)$("#delivery_edit").trigger("click")}})});$("#order_supplier_id").change(function(){var supplier_id=$("#order_supplier_id").val().trim();if(supplier_id!=false){var details=$("#lws_woosupply_supplier_details");var info=$("#supplier-info-div");var contact=[];$.getJSON(details.data("service"),{action:"lws_woosupply_supplier_get",supplier_id:supplier_id},function(response){if(response.error==undefined){$.each(response,function(index,value){if(index=="contact_firstname")contact[0]=value;if(index=="contact_lastname")contact[1]=value;info.find('[data-name="order_supplier_'+index+'"]').html(value);details.find('input[name="order_supplier_'+index+'"]').val(value).trigger("change")});info.find('[data-name="order_supplier_contact"]').html(contact[0]+" "+contact[1]);details.find('input[name="order_supplier_contact"]').val(contact[0]+" "+contact[1]).trigger("change")}else alert(response.error)}).fail(function(){alert("Cannot reach supplier info webservice.")})}else{$("#lws_woosupply_supplier_details input").val("").trigger("change")}});$("#order_remote_invoice_attachement").on("change",function(){var fileMax=$("#upload_max_size");if(fileMax.length>0&&$("#order_remote_invoice_attachement").prop("files")[0].size>fileMax.val()){alert(fileMax.data("warn"));$(".lws-file-selected").text(fileMax.data("warn")).show()}else $(".lws-file-selected").text($("#order_remote_invoice_attachement").prop("files")[0].name).show()});$(".lws-file-selected").hide();$("#order_remote_invoice_amount").change(function(){var field=$(this);var value=field.val().trim();if(value.length>0){$.ajax({url:lws_ajax_url,dataType:"text",data:{action:"lws_woosupply_format_price",price:value},success:function(data){field.val(data)}}).fail(function(){console.log("Cannot reach price formating webservice.");value=parseFloat(value.replace(",","."));field.val(isNaN(value)?"":value)})}else field.val("")})});
